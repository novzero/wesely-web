<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>wesely</title>
	<script src="https://kit.fontawesome.com/a9ad5c8c5b.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="/css/font.css" />
	<link rel="stylesheet" href="/css/header.css" />
	<link rel="stylesheet" href="/css/business/createStore.css" />
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script>
		$(document).ready(function () {
			var fullAddress = $('#address').val();
			var addressParts = fullAddress.split(',');

			// íŒì—… ì£¼ì†Œ ì„¤ì •
			if (addressParts.length > 0) {
				$('#addressClick').val(addressParts[0]);
			}

			// ìƒì„¸ ì£¼ì†Œ ì„¤ì •
			if (addressParts.length > 1) {
				$('#detailAddress').val(addressParts[1]);
				$("#detailAddress").removeClass('not');
				$("#detailAddress").removeAttr('disabled');
			}
		});
	</script>

	<script>
		function deleteImage(inputId, labelId) {
			// delList í•„ë“œì— ì‚­ì œí•  ì´ë¯¸ì§€ì˜ IDë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
			var imgId = $('#' + labelId).data('img-id');
			var currentDelList = $('#delList').val();
			if (currentDelList.length > 0) {
				currentDelList += ',';
			}
			currentDelList += imgId;

			$('#delList').val(currentDelList);

			// í•´ë‹¹ label ìš”ì†Œë¥¼ ì°¾ì•„ì„œ ëŒ€ì²´í•©ë‹ˆë‹¤.
			var newInput = $('<input>')
				.attr('type', 'file')
				.attr('name', 'uploadFile')
				.attr('id', inputId);  // input íƒœê·¸ì— id ê°’ì„ ë¶€ì—¬

			// iorder valueëŠ” ê¸°ì¡´ labelì˜ iorder ê°’ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.
			var iorderValue = $('#' + labelId).find('[name="iorder"]').val();
			var newIOrderInput = $('<input>')
				.attr('type', 'hidden')
				.attr('name', 'iorder')
				.removeAttr('disabled')
				.val(iorderValue);

			$('#' + labelId).empty().append(newInput, newIOrderInput);
		}
	</script>


	<script>
		function checkInput(input) {
			if (input.val().trim() === '') {  // ì…ë ¥ê°’ì´ ì—†ì„ ê²½ìš°
				input.removeClass('off');
				input.addClass('on');

				return false;

			} else {  // ê·¸ë ‡ì§€ ì•Šìœ¼ë©´
				input.removeClass('on');
				input.addClass('off');  // ê²½ê³  ë³´ë” ìˆ¨ê¸°ê¸°
				return true;
			}
		}

		function formCheck() {
			let isValid = true;
			// ì…ë ¥ í•„ë“œ ê°’ ë³€ê²½ ì‹œ
			$('.requiredData').change(function () {
				checkInput($(this));
			});
			// ëª¨ë“  ì…ë ¥ í•„ë“œì— ëŒ€í•˜ì—¬
			$('.requiredData').each(function () {
				if (!checkInput($(this))) {  // ë§Œì•½ í˜„ì¬ ì…ë ¥ í•„ë“œì˜ ê°’ì´ ë¹„ì–´ìˆë‹¤ë©´
					isValid = false;  // ì „ì²´ í¼ì˜ ìœ íš¨ì„±ì„ 'ë¬´íš¨'ë¡œ ì„¤ì •
				}
			});

			let value = $("#storeImges1").val();
			let requiredImg = $('#img1').length > 0 ? $('#img1').attr('src') : null;
			if (value == null || value.trim().length == 0) { // ì²«ë²ˆì§¸ ì´ë¯¸ì§€ input valì´ ì—†ì„ë•Œ
				if (requiredImg && requiredImg.trim().length > 0) { // ì²«ë²ˆì§¸ ê¸°ì¡´ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´
					return true; //í†µê³¼
				}
				else {
					alert('ì²«ë²ˆì§¸ ì´ë¯¸ì§€ëŠ” í•„ìˆ˜ë“±ë¡ì…ë‹ˆë‹¤. ì¸ë„¤ì¼ë¡œ ë“¤ì–´ê°ˆ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); // ê²½ê³ 
					$(".label").first().removeClass('off');
					$(".label").first().addClass('on');
					return false;   // ì „ì†¡ ì·¨ì†Œ
				}
			} else if (value !== null || value.trim().length > 0) { //ì²«ë²ˆì§¸ ì´ë¯¸ì§€ input val ìˆì„ ë•Œ
				$(".label").first().removeClass('on');
				$(".label").first().addClass('off');
			}

			if (!isValid) {  // ë§Œì•½ ì „ì²´ í¼ì˜ ìœ íš¨ì„±ì´ 'ë¬´íš¨'ë¼ë©´
				alert('í•„ìˆ˜ì…ë ¥ë€ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');  // ê²½ê³  ë©”ì‹œì§€ ì¶œë ¥
				return false;  // í¼ ì œì¶œ ì·¨ì†Œ
			}

			return true;
		}

		function updateAddress() {
			// #popupAddressì™€ #detailAddressì˜ valueë¥¼ ê°€ì ¸ì˜¨ë‹¤.
			var popupAddress = $('#addressClick').val();
			var detailAddress = $('#detailAddress').val();

			// ë‘ ì£¼ì†Œ ê°’ì„ í•©ì¹œë‹¤.
			var fullAddress = popupAddress + ', ' + detailAddress;

			// í•©ì¹œ ì£¼ì†Œ ê°’ì„ #addressì— ì„¤ì •í•œë‹¤.
			$('#address').val(fullAddress);
		}
	</script>
</head>

<body>
	<div class="wrapper">
		<header>
			<div class="logo">
				<a href="/">
					<img src="/images/weLogo.png" alt="Logo" />
				</a>
			</div>
			<nav class="bar">
				<a href="/store/"><strong>ìš´ë™ì‹œì„¤ê²€ìƒ‰</strong></a>
				<a href="/community/"><strong>ì»¤ë®¤ë‹ˆí‹°</strong></a>
				<a href="/"><strong>ê³ ê°ì„¼í„°</strong></a>
			</nav>
			<nav class="hello">
				<th:block th:if="${session.mvo != null}">
					<!-- ë³„ëª…ì„ ì„¤ì •í•˜ì§€ ì•Šì€ íšŒì›ì€ ì•„ì´ë””ë¡œ í‘œì‹œëœë‹¤. -->
					<span>[[${session.mvo.nickname}]] </span> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.
				</th:block>
			</nav>

			<nav class="login">
				<th:block th:if="${session.mvo == null}">
					<a href="/member/login"><strong>ë¡œê·¸ì¸</strong></a>
					<a href="/member/join"><strong>íšŒì›ê°€ì…</strong></a>
				</th:block>

				<th:block th:if="${session.mvo != null && session.mvo.authority == 'ì¼ë°˜ê³„ì •'}">
					<a href="/member/updateProfile"><strong>ë§ˆì´í˜ì´ì§€</strong></a>
					<a href="/member/logout"><strong>ë¡œê·¸ì•„ì›ƒ</strong></a>
				</th:block>

				<th:block th:if="${session.mvo != null && session.mvo.authority == 'ë¹„ì¦ˆë‹ˆìŠ¤ê³„ì •'}">
					<a href="/member/updateProfile"><strong>íšŒì›ì •ë³´ìˆ˜ì •</strong></a>
					<a th:href="@{/store/view/b/{userId}(userId=${session.mvo.userid})}"><strong>ë§¤ì¥ê´€ë¦¬</strong></a>
					<a href="/member/logout"><strong>ë¡œê·¸ì•„ì›ƒ</strong></a>
				</th:block>
			</nav>
		</header>

		<!-- ğŸ‘‡ì—¬ê¸°ë¶€í„° ì‹œì„¤ìƒì„¸í˜ì´ì§€ -->
		<main>
			<form action="/business/updateOk" onsubmit="return formCheck()" method="post" enctype="multipart/form-data">
				<div class="fileWrapper">
					<p class="titleText required">ë§¤ì¥ ì‚¬ì§„<span class="subText">ë§¤ì¥ì‚¬ì§„ì€ í•œ ì¥ì´ í•„ìˆ˜ë“±ë¡ì´ë©° ì²«ë²ˆì§¸ ì‚¬ì§„ì´ ì¸ë„¤ì¼ë¡œ
							ì ìš©ë©ë‹ˆë‹¤.</span></p>

					<!-- ê°ê°ì˜ ì´ë¯¸ì§€ì— ëŒ€í•´ 'ì‚­ì œ' ë²„íŠ¼ê³¼ í•¨ê»˜ idê°’ì„ ë¶€ì—¬í•œ file inputê³¼ labelì„ ìƒì„±í•©ë‹ˆë‹¤. -->
					<th:block th:each="num : ${#numbers.sequence(1, 4)}">
						<th:block th:each="img : ${st.imgList}" th:if="${img.iorder == num}">
							<label class="label off" th:id="'label' + ${num}" th:for="'storeImges' + ${num}"
								th:data-img-id="${img.id}">

								<!-- ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œë²„íŠ¼ -->
								<button type="button" class="btnFileDelete"
									th:onclick="'deleteImage(\'storeImges' + ${num} + '\', \'label' + ${num} + '\');'">
									ì‚­ì œ
								</button>

								<input type="hidden" name="iorder" th:value="${img.iorder}" disabled />

								<div>
									<img class="fileImg" th:id="'img' + ${num}"
										th:src='|/static/images/upload/${img.uuid}_${img.fileName}|' alt="ê¸°ì¡´ì´ë¯¸ì§€">
								</div>
							</label>
						</th:block>

						<!-- í•´ë‹¹ iorder ê°’ì´ imgListì— ì—†ìœ¼ë©´ ë¹„ì–´ìˆëŠ” input íƒœê·¸ ì¶œë ¥ -->
						<th:block th:if="${#lists.contains(st.imgList.![iorder], num) == false}">
							<label class="label off" th:for="'storeImges' + ${num}" th:id='|label${num}|'>
								<input th:id='|storeImges${num}|' type="file" name="uploadFile"
									class="uploadFile"></input>
								<!-- ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ì´ë¯¸ì§€ ìˆœì„œ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. -->
								<input type="hidden" name="iorder" th:value='${num}' />
							</label>
						</th:block>
					</th:block>

				</div>
				<!-- ì‚­ì œí•  ì´ë¯¸ì§€ -->
				<input type="hidden" name="delList" id="delList" size="100" />
				<!-- ìœ ì € ì•„ì´ë”” -->
				<input id="userid" th:unless="${session.mvo.nickname == null}" th:value="${session.mvo.userid}"
					type="hidden" name="userid" />
				<!-- STORE ì•„ì´ë”” -->
				<input id="id" th:value="${st.id}" type="hidden" name="id" />
				<!-- ì‹œì„¤ ìœ„ì¹˜ ë‹´ê¸° -->
				<input class="addText" id="region" type="hidden" name="region" th:value="${st.region}">

				<p class="titleText required">ë§¤ì¥ ì´ë¦„</p>
				<input class="requiredData addText off" id="name" type="text" placeholder="ë§¤ì¥ì´ë¦„" name="name"
					th:value="${st.name}">

				<p class="titleText required">ë§¤ì¥ ì£¼ì†Œ<span class="wranText">(í•„ìˆ˜)</span></p>
				<!-- hidden : ì¡°í•©ëœ ì£¼ì†Œë°ì´í„° -->
				<input class="requiredData addText off" id="address" type="hidden" name="address"
					th:value="${st.address}">
				<!-- ì¹´ì¹´ì˜¤ìš°í¸ì£¼ì†Œ api íŒì—…ë²„íŠ¼ -->
				<input class="popupAddress off" type="button" id="addressClick" onclick="clickAddress()">
				<!-- ìƒì„¸ì£¼ì†Œ -->
				<input class="requiredData off detailAddress not" id="detailAddress" type="text" name="detailAddress"
					onchange="updateAddress()" disabled>

				<p class="titleText required">í•´ì‰¬íƒœê·¸</p>
				<input class="requiredData addText off" id="hashTag" type="text" placeholder="í•´ì‰¬íƒœê·¸" name="hashTag"
					th:value="${st.hashTag}">
				<p class="titleText">ë§¤ì¥ ìš´ì˜ì‹œê°„</p>
				<input class="addText off" id="opening" type="text" placeholder="ë§¤ì¥ìš´ì˜ì‹œê°„" name="opening"
					th:value="${st.opening}">
				<p class="titleText required">ë§¤ì¥ ì „í™”ë²ˆí˜¸</p>
				<input class="requiredData addText off" id="tel" type="text" placeholder="ë§¤ì¥ì „í™”ë²ˆí˜¸" name="tel"
					th:value="${st.tel}">
				<p class="titleText">ë§¤ì¥ ì†Œê°œ</p>
				<input class="addTextDes off" id="dec" type="text" placeholder="ë§¤ì¥ì„¤ëª…" name="description"
					th:value="${st.description}">
				<div class="modalBtn">
					<input class="btnCancle" type="button" value="ì·¨ì†Œ" th:onclick="location.href='/'"></input>
					<input class="btnAdd" type="submit" value="ìˆ˜ì •"></input>
				</div>
			</form>
		</main>
		<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script>
			function clickAddress() {
				//íŒì—… ìœ„ì¹˜ë¥¼ ì§€ì •(í™”ë©´ì˜ ê°€ìš´ë° ì •ë ¬)
				var width = 500; //íŒì—…ì˜ ë„ˆë¹„
				var height = 600; //íŒì—…ì˜ ë†’ì´

				new daum.Postcode({
					width: width, //ìƒì„±ìì— í¬ê¸° ê°’ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.
					height: height,
					oncomplete: function (data) {
						// íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.
						// ì˜ˆì œë¥¼ ì°¸ê³ í•˜ì—¬ ë‹¤ì–‘í•œ í™œìš©ë²•ì„ í™•ì¸í•´ ë³´ì„¸ìš”.
						var addr = ''; // ì£¼ì†Œ ë³€ìˆ˜
						var extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜
						//ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
						if (data.userSelectedType === 'R') { // ì‚¬ìš©ìê°€ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°
							if (data.jibunAddress === "") { // ë§µí•‘ëœ ê²ƒë“¤ì´ ì—¬ëŸ¬ê°œì—¬ì„œ ì •í™•í•œ ê°’ì„ ê°€ì ¸ì˜¤ì§€ ëª»í•œ ê²½ìš°
								addr = data.autoJibunAddress; // ìë™ìœ¼ë¡œ ë“¤ì–´ê°€ê²Œ í•˜ê¸°
							} else {
								addr = data.jibunAddress;
							}
						} else { // ì‚¬ìš©ìê°€ ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°(J)
							addr = data.jibunAddress;
						}

						var partAddr = addr.split(' ');
						
						$("#region").val(partAddr[1] + partAddr[2]);
						// ì£¼ì†Œ ë‹´ê¸°
						$("#addressClick").val(addr);
						// disabled í’€ì–´ì£¼ê³  css ì ìš©í•˜ê¸°
						$("#detailAddress").removeClass('not');
						$("#detailAddress").removeAttr('disabled');
						// ì»¤ì„œë¥¼ ìƒì„¸ì£¼ì†Œ í•„ë“œë¡œ ì´ë™í•œë‹¤.
						$("#detailAddress").focus();
						updateAddress();
					}
				}).open({
					left: (window.screen.width / 2) - (width / 2),
					top: (window.screen.height / 2) - (height / 2)
				});
			}
		</script>
</body>

</html>