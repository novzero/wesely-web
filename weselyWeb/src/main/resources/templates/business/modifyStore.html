<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>wesely</title>
	<script src="https://kit.fontawesome.com/a9ad5c8c5b.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="/css/font.css" />
	<link rel="stylesheet" href="/css/header.css" />
	<link rel="stylesheet" href="/css/business/createStore.css" />
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		function deleteImage(inputId, labelId) {
			// delList í•„ë“œì— ì‚­ì œí•  ì´ë¯¸ì§€ì˜ IDë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
			var imgId = $('#' + labelId).data('img-id');
			var currentDelList = $('#delList').val();
			if (currentDelList.length > 0) {
				currentDelList += ',';
			}
			currentDelList += imgId;

			$('#delList').val(currentDelList);

			alert($('#delList').val());

			// í•´ë‹¹ ì´ë¯¸ì§€ì™€ ê´€ë ¨ëœ input í•„ë“œì™€ labelì„ ì œê±°í•©ë‹ˆë‹¤.
			$('#' + inputId).remove();
			$('#' + labelId).remove();

			// ìƒˆë¡œìš´ file input í•„ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
			var newInput = $('<input>')
				.attr('type', 'file')
				.attr('name', 'uploadFile');

			$('.fileWrapper').append(newInput);
		}
	</script>



	<!-- Scripts -->
	<script scr="javascript">
		function formCheck() {
			let hasImage = false;
			$('input[type="file"]').each(function () {
				if ($(this).val()) {
					hasImage = true;
					return false; // break the loop
				}
			});

			if (!hasImage) {
				alert('ì´ë¯¸ì§€ëŠ” ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
				return false;
			}
			
			
			value = $(".addText").val(); // ë‚´ìš© ì–»ê³ 
			if (value == null || value.trim().length == 0) { // ì—†ê±°ë‚˜ ë¹ˆì¹¸ë“¤ë¡œë§Œ  ì…ë ¥ë˜ì—ˆë‹¤ë©´
				alert('ë‚´ìš©ì€ ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.'); // ê²½ê³ 

				return false;   // ì „ì†¡ ì·¨ì†Œ
			}
			return true;
		}
	</script>
</head>

<body>
	<div class="wrapper">
		<header>
			<div class="logo">
				<a href="/">
					<img src="/images/weLogo.png" alt="Logo" />
				</a>
			</div>
			<nav class="bar">
				<a href="/store/"><strong>ìš´ë™ì‹œì„¤ê²€ìƒ‰</strong></a>
				<a href="/community/"><strong>ì»¤ë®¤ë‹ˆí‹°</strong></a>
				<a href="/"><strong>ê³ ê°ì„¼í„°</strong></a>
			</nav>
			<nav class="login">
				<th:block th:if="${session.mvo == null}">
					<a href="/member/login"><strong>ë¡œê·¸ì¸</strong></a>
					<a href="/member/join"><strong>íšŒì›ê°€ì…</strong></a>
				</th:block>

				<th:block th:if="${session.mvo != null && session.mvo.authority == 'ì¼ë°˜ê³„ì •'}">
					<a href="/member/updateProfile"><strong>ë§ˆì´í˜ì´ì§€</strong></a>
					<a href="/member/logout"><strong>ë¡œê·¸ì•„ì›ƒ</strong></a>
				</th:block>

				<th:block th:if="${session.mvo != null && session.mvo.authority == 'ë¹„ì¦ˆë‹ˆìŠ¤ê³„ì •'}">
					<a href="/member/updateProfile"><strong>íšŒì›ì •ë³´ìˆ˜ì •</strong></a>
					<a th:href="@{/store/view/b/{userId}(userId=${session.mvo.userid})}"><strong>ë§¤ì¥ê´€ë¦¬</strong></a>
					<a href="/member/logout"><strong>ë¡œê·¸ì•„ì›ƒ</strong></a>
				</th:block>
			</nav>
		</header>

		<!-- ğŸ‘‡ì—¬ê¸°ë¶€í„° ì‹œì„¤ìƒì„¸í˜ì´ì§€ -->
		<main>
			<form action="/business/updateOk" onsubmit="return formCheck()" method="post" enctype="multipart/form-data">
				<div class="fileWrapper">
					<p class="titleText required">ë§¤ì¥ ì‚¬ì§„<span class="subText"> ì²«ë²ˆì§¸ëŠ” í•„ìˆ˜ë“±ë¡ì´ë©°, ì¸ë„¤ì¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.</span></p>

					<!-- ê°ê°ì˜ ì´ë¯¸ì§€ì— ëŒ€í•´ 'ì‚­ì œ' ë²„íŠ¼ê³¼ í•¨ê»˜ id ê°’ì„ ë¶€ì—¬í•œ file inputê³¼ labelì„ ìƒì„±í•©ë‹ˆë‹¤. -->
					<th:block th:each="img, vs : ${st.imgList}">
						<label class="addImgItem" th:id="'label' + ${vs.count}" th:for="'storeImges' + ${vs.count}"
							th:data-img-id="${img.id}">
							<input type="file" th:id="'storeImges' + ${vs.count}" class="inputFile" name="uploadFile">

							<!--ì‚­ì œë²„íŠ¼-->
							<button type="button"
								th:onclick="'deleteImage(\'storeImges' + ${vs.count} + '\', \'label' + ${vs.count} + '\');'">ì‚­ì œ</button>

							<span th:text="${img.fileName}"></span>
							<div>
								<img th:id="'img' + ${vs.count}" class="fileImg on"
									th:src='|/static/images/upload/${img.uuid}_${img.fileName}|'>
							</div>
						</label>
					</th:block>

					<th:block th:if="${#lists.size(st.imgList)<4}">
						<th:block th:each="num : ${#numbers.sequence(#lists.size(st.imgList)+1, 4)}">
							<label class="addImgItem" for="'storeImges' + ${num}">
								<input id="'storeImges' + ${num}" type="file" name="uploadFile">
								<!-- ì›í•˜ëŠ” ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš” -->
								</input>
							</label>
						</th:block>
					</th:block>
				</div>

				<input type="hidden" name="delList" id="delList" size="100" />
				<input th:if="${session.mvo.nickname == null}" type="text" th:value="${session.mvo.username}"
					disabled />
				<input id="userid" th:unless="${session.mvo.nickname == null}" th:value="${session.mvo.userid}"
					type="hidden" name="userid" />
				<input id="id" th:value="${st.id}" type="hidden" name="id" />

				<p class="titleText required">ë§¤ì¥ ì´ë¦„</p>
				<input class="addText" id="name" type="text" placeholder="ë§¤ì¥ì´ë¦„" name="name" th:value="${st.name}">
				<p class="titleText required">ë§¤ì¥ ì£¼ì†Œ</p>
				<input class="addText" id="address" type="text" placeholder="ë§¤ì¥ì£¼ì†Œ" name="address"
					th:value="${st.address}">
				<p class="titleText">í•´ì‰¬íƒœê·¸</p>
				<input class="addText" id="hashTag" type="text" placeholder="í•´ì‰¬íƒœê·¸" name="hashTag"
					th:value="${st.hashTag}">
				<p class="titleText">ë§¤ì¥ ìš´ì˜ì‹œê°„</p>
				<input class="addText" id="opening" type="text" placeholder="ë§¤ì¥ìš´ì˜ì‹œê°„" name="opening"
					th:value="${st.opening}">
				<p class="titleText required">ë§¤ì¥ ì „í™”ë²ˆí˜¸</p>
				<input class="addText" id="tel" type="text" placeholder="ë§¤ì¥ì „í™”ë²ˆí˜¸" name="tel" th:value="${st.tel}">
				<p class="titleText">ë§¤ì¥ ì†Œê°œ(ì„¤ëª…)</p>
				<input class="addTextDes" id="dec" type="text" placeholder="ë§¤ì¥ì„¤ëª…" name="description"
					th:value="${st.description}">
				<div class="modalBtn">
					<input class="btnCancle" type="button" value="ì·¨ì†Œ" th:onclick="location.href='/'"></input>
					<input class="btnAdd" type="submit" value="ë“±ë¡"></input>
				</div>
			</form>
		</main>
</body>

</html>